<html>
    <head>
        <style>
            .hidden {
                display: none;
            }
        </style>
    </head>

    <body>

        <div id="badge">
            <img src="" />
        </div>

        <div id="repository">
            <div class="compliant hidden">
                <h1>Use a publicly accessible repository with version control</h1>
                <p>
                Well done
                </p>
            </div>
            <div class="noncompliant">
                <h1>Use a publicly accessible repository with version control</h1>
                <p>
                Here's what to do about it
                </p>
            </div>
        </div>

        <div id="license">
            <div class="compliant hidden">
                <h1>Add a license</h1>
                <p>
                Well done
                </p>
            </div>
            <div class="noncompliant">
                <h1>Add a license</h1>
                <p>
                Here's what to do about it
                </p>
            </div>
        </div>

        <div id="registry">
            <div class="compliant hidden">
                <h1>Register your code in a community registry</h1>
                <p>
                Well done
                </p>
            </div>
            <div class="noncompliant">
                <h1>Register your code in a community registry</h1>
                <p>
                Here's what to do about it
                </p>
            </div>
        </div>

        <div id="citation">
            <div class="compliant hidden">
                <h1>Enable citation of the software</h1>
                <p>
                Well done
                </p>
            </div>
            <div class="noncompliant">
                <h1>Enable citation of the software</h1>
                <p>
                Here's what to do about it
                </p>
            </div>
        </div>

        <div id="checklist">
            <div class="compliant hidden">
                <h1>Use a software quality checklist</h1>
                <p>
                Well done
                </p>
            </div>
            <div class="noncompliant">
                <h1>Use a software quality checklist</h1>
                <p>
                Here's what to do about it
                </p>
            </div>
        </div>

        <script>
            const getQueryVariable = (variable) => {
                const query = window.location.search.substring(1);
                const pairs = query.split("&");
                for (const pair of pairs) {
                    const [key, value] = pair.split("=")
                    if (key === variable) {
                        return value;
                    }
                }
                return "";
            }

            const getBadgeColor = (compliance) => {
                const colors = ["red","red","orange","orange","yellow", "green"];
                const count = compliance.filter((elem) => {return elem === "1"}).length;
                return colors[count];
            };

            const getBadgeSymbols = (elem) => {
                const symbol_compliant = "%E2%97%8F";
                const symbol_noncompliant = "%E2%97%8B";
                if (elem === "1") {
                    return symbol_compliant;
                }
                return symbol_noncompliant;
            };

            const setBadge = (compliance) => {
                const state = compliance.map(getBadgeSymbols).join("%20%20");
                const color = getBadgeColor(compliance);
                const src = "https:\/\/img.shields.io\/badge\/fair--software.eu-" + state + "-" + color;
                document.getElementById("badge").getElementsByTagName("img")[0].src = src;
            }

            const setVisibility = (compliance) => {
                const recommendations = ["repository", "license", "registry", "citation", "checklist"];
                
                for (const [i, recommendation] of recommendations.entries()) {
                    if (compliance[i] === "1") {
                        document.getElementById(recommendation)
                                .getElementsByClassName("compliant")[0].classList.remove("hidden")
                        document.getElementById(recommendation)
                                .getElementsByClassName("noncompliant")[0].classList.add("hidden")
                    } else {
                        document.getElementById(recommendation)
                                .getElementsByClassName("compliant")[0].classList.add("hidden")
                        document.getElementById(recommendation)
                                .getElementsByClassName("noncompliant")[0].classList.remove("hidden")
                    }
                }
            }

            const compliance = (getQueryVariable("compliance") + "00000").split("").slice(0, 5);
            setBadge(compliance)
            setVisibility(compliance)

        </script>

    </body>
</html>